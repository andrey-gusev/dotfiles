#!/usr/bin/env bash

PID_FILE="/tmp/recpid"
SAVE_DIR="$HOME/recvids"

# Создаем папку, если её нет
mkdir -p "$SAVE_DIR"

record() {
    # Записываем PID сразу при запуске
    wf-recorder -a -f "$SAVE_DIR/$(date +%Y-%m-%d-%H-%M-%S).mp4" & 
    echo $! > "$PID_FILE"
    notify-send "Запись началась"
}

end() {
    if [[ -f "$PID_FILE" ]]; then
        kill -15 "$(cat "$PID_FILE")" && rm "$PID_FILE"
        notify-send "Запись сохранена" "$SAVE_DIR"
    fi
}

if [[ -f "$PID_FILE" ]]; then
    end
else
    record
fi
